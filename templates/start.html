<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Welcome to AIChatFlows Setup</title>
  <link rel="stylesheet" href="/static/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <meta name="description" content="Start your AI-powered chatbot setup with AIChatFlows">
  <meta name="robots" content="noindex">
  <style>
    /* Setup page specific styles */
    .setup-container {
      min-height: 100vh;
      background: var(--clr-dark);
      padding-top: 2em;
      padding-bottom: 4em;
    }
    
    .setup-content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 2em;
    }
    
    .setup-header {
      text-align: center;
      margin-bottom: 3em;
      padding-bottom: 2em;
    }
    
    .setup-header h1 {
      font-family: var(--ff-heading);
      font-size: 3.5rem;
      color: var(--clr-primary);
      margin-bottom: 0.5em;
      line-height: 1.2;
    }
    
    .setup-header p {
      font-size: 1.2rem;
      color: var(--clr-light);
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .form-container {
      background: var(--clr-secondary);
      border-radius: 16px;
      padding: 3em;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .form-section {
      margin-bottom: 3em;
      padding-bottom: 2em;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .form-section:last-of-type {
      border-bottom: none;
      margin-bottom: 2em;
    }
    
    .section-title {
      font-family: var(--ff-heading);
      font-size: 1.75rem;
      color: var(--clr-primary);
      margin-bottom: 1.5em;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5em;
    }
    
    @media (min-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .form-group {
      margin-bottom: 1.5em;
    }
    
    .form-group label {
      display: block;
      color: var(--clr-light);
      font-weight: 600;
      margin-bottom: 0.5em;
      font-size: 1rem;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75em 1em;
      background: var(--clr-dark);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: var(--clr-light);
      font-size: 1rem;
      font-family: var(--ff-sans);
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--clr-primary);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .radio-group,
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 0.75em;
    }
    
    .radio-group label,
    .checkbox-group label {
      display: flex;
      align-items: flex-start;
      gap: 0.75em;
      cursor: pointer;
      font-weight: 400;
    }
    
    .radio-group input[type="radio"],
    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin: 0;
      margin-top: 0.25em;
    }
    
    .plan-option {
      display: flex;
      align-items: center;
      padding: 1.5em;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      cursor: pointer;
      transition: border-color 0.3s ease;
      gap: 1em;
    }
    
    .plan-option:hover {
      border-color: var(--clr-primary);
    }
    
    .plan-option input[type="radio"] {
      margin: 0;
    }
    
    .plan-details h4 {
      color: var(--clr-light);
      font-weight: 600;
      margin-bottom: 0.25em;
    }
    
    .plan-details p {
      color: var(--clr-light);
      opacity: 0.7;
      font-size: 0.9rem;
    }
    
    .conditional-section {
      margin-top: 1.5em;
      padding: 1.5em;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 230, 118, 0.3);
      border-radius: 12px;
      display: none;
    }
    
    .conditional-section.show {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .conditional-message {
      margin-top: 1.5em;
      padding: 1.5em;
      background: rgba(0, 123, 255, 0.1);
      border: 1px solid rgba(0, 123, 255, 0.3);
      border-radius: 12px;
      display: none;
    }
    
    .conditional-message.show {
      display: block;
    }
    
    .conditional-message h4 {
      color: var(--clr-accent-blue);
      margin-bottom: 0.5em;
      font-weight: 600;
    }
    
    .conditional-message p {
      color: var(--clr-light);
      opacity: 0.9;
    }
    
    .security-notice {
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin-bottom: 1em;
      padding: 1em;
      background: rgba(0, 230, 118, 0.1);
      border: 1px solid rgba(0, 230, 118, 0.3);
      border-radius: 8px;
    }
    
    .security-notice p {
      color: var(--clr-light);
      font-size: 0.9rem;
      margin: 0;
    }
    
    .file-upload-info {
      font-size: 0.85rem;
      color: var(--clr-light);
      opacity: 0.7;
      margin-top: 0.5em;
    }
    
    .file-upload-info.success {
      color: var(--clr-primary);
      opacity: 1;
    }
    
    .file-upload-info.error {
      color: #ff6b6b;
      opacity: 1;
    }
    
    .divider {
      text-align: center;
      color: var(--clr-light);
      opacity: 0.5;
      margin: 1.5em 0;
      font-weight: 500;
    }
    
    .submit-section {
      text-align: center;
      margin-top: 2em;
    }
    
    .submit-button {
      padding: 1.25em 3em;
      font-size: 1.2rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1.5em;
    }
    
    .privacy-text {
      font-size: 0.85rem;
      color: var(--clr-light);
      opacity: 0.7;
      line-height: 1.5;
    }
    
    .privacy-text a {
      color: var(--clr-primary);
      text-decoration: none;
    }
    
    .privacy-text a:hover {
      text-decoration: underline;
    }
    
    .error-message,
    .success-message {
      padding: 1.5em;
      border-radius: 12px;
      margin-bottom: 1em;
      font-size: 1rem;
      text-align: center;
      display: none;
    }
    
    .error-message {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.3);
      color: #ff6b6b;
    }
    
    .general-error {
      background: rgba(255, 82, 82, 0.1);
      border: 1px solid rgba(255, 82, 82, 0.3);
      color: #ff5252;
      padding: 1.5em;
      border-radius: 12px;
      margin-bottom: 1em;
      font-size: 1rem;
      text-align: center;
      display: none;
    }
    
    .form-error {
      color: #ff5252;
      font-size: 0.9rem;
      font-family: var(--ff-sans);
      margin-top: 0.25rem;
      display: none;
    }
    
    input.error, textarea.error, select.error {
      border: 1px solid #ff5252 !important;
      background-color: rgba(255, 82, 82, 0.05);
    }
    
    .checkbox-group label.error {
      color: #ff5252;
    }
    
    .radio-group label.error {
      color: #ff5252;
    }
    
    .success-message {
      background: rgba(0, 230, 118, 0.1);
      border: 1px solid rgba(0, 230, 118, 0.3);
      color: var(--clr-primary);
    }
    
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 2em;
    }
    
    .loading-spinner::after {
      content: "";
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0, 230, 118, 0.3);
      border-top-color: var(--clr-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @media (max-width: 767px) {
      .setup-header h1 {
        font-size: 2.5rem;
      }
      
      .form-container {
        padding: 2em 1.5em;
      }
      
      .setup-content {
        padding: 0 1em;
      }
      
      .plan-option {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5em;
      }
    }
  </style>
</head>
<body>
  <div class="setup-container">
    <div class="setup-content">
      <!-- Header -->
      <div class="setup-header">
        <h1>üöÄ AIChatFlows Setup</h1>
        <p>
          Welcome! Let's get your AI-powered chatbot automation system set up. 
          This secure form will collect your business information and preferences.
        </p>
      </div>
      
      <!-- Form Container -->
      <div class="form-container">
        <!-- Messages -->
        <div id="generalError" class="general-error"></div>
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>
        <div id="loadingSpinner" class="loading-spinner"></div>
        
        <form id="onboardingForm" method="post" action="/api/submit-onboarding" enctype="multipart/form-data">
          <!-- 1. Business Information -->
          <div class="form-section">
            <h2 class="section-title">
              üßæ Business Information
            </h2>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="business_name">Business Name *</label>
                <input type="text" id="business_name" name="business_name" required maxlength="100">
                <div id="business_name_error" class="form-error"></div>
              </div>
              
              <div class="form-group">
                <label for="instagram_handle">Business Instagram Handle *</label>
                <input type="text" id="instagram_handle" name="instagram_handle" required maxlength="30" placeholder="@yourbusiness">
                <div id="instagram_handle_error" class="form-error"></div>
              </div>
              
              <div class="form-group">
                <label for="other_platforms">Other Platforms to Integrate</label>
                <input type="text" id="other_platforms" name="other_platforms" maxlength="200" placeholder="TikTok, Facebook, etc.">
              </div>
              
              <div class="form-group">
                <label for="business_type">Business Type or Niche *</label>
                <select id="business_type" name="business_type" required>
                  <option value="">Select your business type</option>
                  <option value="Restaurant">Restaurant</option>
                                    <option value="Coffee Shop">Coffee Shop</option>
                                    <option value="Deli">Deli</option>
                  <option value="Retail">Retail</option>
                  <option value="Service">Service</option>
                  <option value="E-commerce">E-commerce</option>
                  <option value="Healthcare">Healthcare</option>
                  <option value="Beauty & Wellness">Beauty & Wellness</option>
                  <option value="Real Estate">Real Estate</option>
                  <option value="Education">Education</option>
                  <option value="Other">Other</option>
                </select>
                <div id="business_type_error" class="form-error"></div>
              </div>
              
              <!-- Other Business Type (conditional) -->
              <div id="otherBusinessTypeSection" class="form-group" style="display: none;">
                <label for="other_business_type">Please specify your business type *</label>
                <input type="text" id="other_business_type" name="other_business_type" maxlength="100" placeholder="Enter your business type...">
                <div id="other_business_type_error" class="form-error"></div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="product_service_description">What products or services do you offer? *</label>
              <textarea id="product_service_description" name="product_service_description" required maxlength="1000" rows="4" 
                        placeholder="Describe your main products or services..."></textarea>
              <div id="product_service_description_error" class="form-error"></div>
            </div>
            
            <div class="form-group">
              <label for="common_customer_question">What are the most common questions your customers ask? *</label>
              <textarea id="common_customer_question" name="common_customer_question" required maxlength="500" rows="3" 
                        placeholder="e.g., Hours, pricing, availability, location..."></textarea>
              <div id="common_customer_question_error" class="form-error"></div>
            </div>
          </div>
          
          <!-- 2. Delivery & Pickup Info -->
          <div class="form-section">
            <h2 class="section-title">
              üßæ Delivery & Pickup Info
            </h2>
            
            <div class="form-group">
              <label>Do you offer delivery or pickup? *</label>
              <div class="radio-group">
                <label>
                  <input type="radio" name="delivery_pickup" value="Delivery" required>
                  <span>Delivery only</span>
                </label>
                <label>
                  <input type="radio" name="delivery_pickup" value="Pickup" required>
                  <span>Pickup only</span>
                </label>
                <label>
                  <input type="radio" name="delivery_pickup" value="Both" required>
                  <span>Both</span>
                </label>
                <label>
                  <input type="radio" name="delivery_pickup" value="Neither" required>
                  <span>Neither</span>
                </label>
              </div>
              <div id="delivery_pickup_error" class="form-error"></div>
            </div>
            
            <!-- Delivery Services (conditional) -->
            <div id="deliveryServices" class="conditional-section">
              <h3 class="section-title">Delivery Service Options</h3>
              <div class="checkbox-group">
                <label>
                  <input type="checkbox" name="delivery_services" value="Uber Eats">
                  <span>Uber Eats</span>
                </label>
                <label>
                  <input type="checkbox" name="delivery_services" value="DoorDash">
                  <span>DoorDash</span>
                </label>
                <label>
                  <input type="checkbox" name="delivery_services" value="Grubhub">
                  <span>Grubhub</span>
                </label>
                <label>
                  <input type="checkbox" name="delivery_services" value="In-house delivery">
                  <span>In-house delivery</span>
                </label>
              </div>
              <div class="form-group">
                <label for="delivery_other">Other delivery service:</label>
                <input type="text" id="delivery_other" name="delivery_other" placeholder="Specify other delivery service...">
              </div>
            </div>
            
            <!-- Pickup Options (conditional) -->
            <div id="pickupOptions" class="conditional-section">
              <h3 class="section-title">How does pickup work?</h3>
              <div class="form-group">
                <div class="radio-group">
                  <label>
                    <input type="radio" name="pickup_method" value="Customers call to place an order">
                    <span>Customers call to place an order</span>
                  </label>
                  <label>
                    <input type="radio" name="pickup_method" value="Customers use an app or link">
                    <span>Customers use an app or link</span>
                  </label>
                  <label>
                    <input type="radio" name="pickup_method" value="Walk-in only">
                    <span>Walk-in only</span>
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label for="pickup_details">Add details or link:</label>
                <input type="text" id="pickup_details" name="pickup_details" placeholder="App name, website, or additional details...">
              </div>
            </div>
          </div>
          
          <!-- 3. Menu Submission -->
          <div class="form-section">
            <h2 class="section-title">
              üìã Menu Submission
            </h2>
            
            <div class="form-group">
              <label for="menu_upload">Upload your menu (JPG, PNG, PDF, max 5MB)</label>
              <input type="file" id="menu_upload" name="menu_upload" accept=".jpg,.jpeg,.png,.pdf">
              <p id="menuFileInfo" class="file-upload-info">No file selected</p>
            </div>
            
            <div class="divider">OR</div>
            
            <div class="form-group">
              <label for="menu_text">Paste your menu</label>
              <textarea id="menu_text" name="menu_text" rows="8" placeholder="Paste your menu items, prices, and descriptions here..."></textarea>
            </div>
            
            <div class="form-group">
              <label for="additional_docs">Upload additional docs: store photos, price sheets, chat screenshots</label>
              <input type="file" id="additional_docs" name="additional_docs" multiple accept=".jpg,.jpeg,.png,.pdf">
              <p id="additionalDocsInfo" class="file-upload-info">No files selected</p>
            </div>
          </div>
          
          <!-- 4. Login Credentials for Setup -->
          <div class="form-section">
            <h2 class="section-title">
              üîê Login Credentials for Setup
            </h2>
            
            <div class="form-group">
              <label>Which plan are you signing up for? *</label>
              <div class="radio-group">
                <label class="plan-option">
                  <input type="radio" name="plan" value="Starter" required>
                  <div class="plan-details">
                    <h4>Starter ‚Äì $50 setup + $100/month</h4>
                    <p>Basic automation for Instagram</p>
                  </div>
                </label>
                <label class="plan-option">
                  <input type="radio" name="plan" value="Pro" required>
                  <div class="plan-details">
                    <h4>Pro ‚Äì $50 setup + $150/month</h4>
                    <p>Multi-platform automation (Instagram, Facebook, TikTok)</p>
                  </div>
                </label>
              </div>
              <div id="plan_error" class="form-error"></div>
            </div>
            
            <div class="form-group">
              <label>How would you like to share your login credentials? *</label>
              <div class="radio-group">
                <label>
                  <input type="radio" name="submission_method" value="Submit through this page" required>
                  <span>Submit credentials directly through this form</span>
                </label>
                <label>
                  <input type="radio" name="submission_method" value="Use SendSecure.ly" required>
                  <span>Use SendSecure.ly to share credentials</span>
                </label>
                <label>
                  <input type="radio" name="submission_method" value="Request In-Person Setup" required>
                  <span>I'd like to schedule a live call to give access</span>
                </label>
              </div>
              <div id="submission_method_error" class="form-error"></div>
            </div>
            
            <!-- SendSecure.ly Message -->
            <div id="sendSecurelyMessage" class="conditional-message">
              <h4>üìß SendSecure.ly Selected</h4>
              <p>You've chosen to use SendSecure.ly to share your login information. After submitting this form, we'll email you a private link where you can securely enter your credentials. Please keep an eye on your inbox!</p>
            </div>
            
            <!-- Login fields (conditional) -->
            <div id="loginSection" class="conditional-section">
              <div class="security-notice">
                <span>üõ°Ô∏è</span>
                <p>Your login information is encrypted and only used for one-time setup. It is never saved.</p>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label for="instagram_email">Instagram Username *</label>
                  <input type="text" id="instagram_email" name="instagram_email" autocomplete="off">
                  <div id="instagram_email_error" class="form-error"></div>
                </div>
                
                <div class="form-group">
                  <label for="instagram_password">Instagram Password *</label>
                  <input type="password" id="instagram_password" name="instagram_password" autocomplete="off">
                  <div id="instagram_password_error" class="form-error"></div>
                </div>
              </div>
              
              <!-- Pro Plan Additional Fields -->
              <div id="proLoginSection" class="conditional-section">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="facebook_email">Facebook Username (optional)</label>
                    <input type="text" id="facebook_email" name="facebook_email" autocomplete="off">
                    <div id="facebook_email_error" class="form-error"></div>
                  </div>
                  
                  <div class="form-group">
                    <label for="facebook_password">Facebook Password (optional)</label>
                    <input type="password" id="facebook_password" name="facebook_password" autocomplete="off">
                    <div id="facebook_password_error" class="form-error"></div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="other_platform_credentials">Other Platform Credentials</label>
                <textarea id="other_platform_credentials" name="other_platform_credentials" rows="3" 
                          placeholder="TikTok, WhatsApp, or other platform login details..."></textarea>
              </div>
            </div>
          </div>
          
          <!-- 5. Additional FAQ & Support Docs -->
          <div class="form-section">
            <h2 class="section-title">
              ‚ùì Additional FAQ & Support Docs
            </h2>
            
            <div class="form-group">
              <label>Do you have a customer FAQ document?</label>
              <div class="radio-group">
                <label>
                  <input type="radio" name="has_faqs" value="true">
                  <span>Yes ‚Äî Upload it below</span>
                </label>
                <label>
                  <input type="radio" name="has_faqs" value="false">
                  <span>No ‚Äî I'll let the bot learn from customer questions</span>
                </label>
              </div>
            </div>
            
            <div id="faqUploadSection" class="conditional-section">
              <div class="form-group">
                <label for="faq_upload">Upload FAQ Document</label>
                <input type="file" id="faq_upload" name="faq_upload" accept=".pdf,.doc,.docx,.txt">
                <p id="faqFileInfo" class="file-upload-info">No file selected</p>
              </div>
            </div>
          </div>
          
          <!-- 6. Contact for Updates & Support -->
          <div class="form-section">
            <h2 class="section-title">
              üìß Contact for Updates & Support
            </h2>
            
            <div class="form-group">
              <label for="contact_email">Contact Email *</label>
              <input type="email" id="contact_email" name="contact_email" required maxlength="254">
              <div id="contact_email_error" class="form-error"></div>
            </div>
          </div>
          
          <!-- 7. Confirmation & Consent -->
          <div class="form-section">
            <h2 class="section-title">
              ‚úÖ Confirmation & Consent
            </h2>
            
            <div class="checkbox-group">
              <label>
                <input type="checkbox" id="confirm_accurate" name="confirm_accurate" required>
                <span>I confirm the information provided is accurate</span>
              </label>
              
              <label>
                <input type="checkbox" id="consent_automation" name="consent_automation" required>
                <span>I consent to AIChatFlows setting up automation on my accounts</span>
              </label>
              
              <label>
                <input type="checkbox" id="consent_to_share" name="consent_to_share" required>
                <span>I agree to the <a href="/legal#privacy" target="_blank">Privacy Policy</a> and <a href="/legal#terms" target="_blank">Terms of Service</a></span>
              </label>
            </div>
            <div id="consent_checkboxes_error" class="form-error"></div>
          </div>
          
          <!-- 8. Final Checklist Before Submitting -->
          <div class="form-section">
            <h2 class="section-title">
              üîÑ Final Checklist Before Submitting
            </h2>
            
            <div class="checkbox-group">
              <label>
                <input type="checkbox" id="checklist_menu" name="checklist_menu">
                <span>I uploaded or wrote out my full menu</span>
              </label>
              
              <label>
                <input type="checkbox" id="checklist_plan" name="checklist_plan">
                <span>I selected a plan and filled in login details</span>
              </label>
              
              <label>
                <input type="checkbox" id="checklist_delivery" name="checklist_delivery">
                <span>I provided delivery/pickup service details</span>
              </label>
              
              <label>
                <input type="checkbox" id="checklist_ready" name="checklist_ready">
                <span>I'm ready to begin setup</span>
              </label>
            </div>
          </div>
          
          <!-- Submit Button -->
          <div class="submit-section">
            <button type="submit" id="submitButton" class="btn submit-button">
              üéâ Start My Setup
            </button>
            
            <p class="privacy-text">
              üîí Your information is encrypted and secure. We take your privacy seriously.<br>
              <a href="/legal#privacy">Privacy Policy</a> | 
              <a href="/legal#terms">Terms of Service</a>
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Enhanced JavaScript -->
  <script>
    (function() {
      'use strict';
      
      // Security measures
      document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', e => {
        if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || (e.ctrlKey && e.keyCode === 85)) {
          e.preventDefault();
        }
      });
      
      // Input sanitization
      function sanitizeInput(input) {
        if (typeof input !== 'string') return input;
        return input.replace(/[<>]/g, '').replace(/javascript:/gi, '').replace(/vbscript:/gi, '').replace(/on\\w+\s*=/gi, '').trim();
      }
      
      // Form validation
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\\.[^\s@]+$/;
        return email.includes('@') && email.includes('.') && email.length > 5;
      }
      
      function validateRequired(value) {
        return value !== null && value !== undefined && value.toString().trim() !== '';
      }
      
      // File upload validation
      function validateFileUpload(file, maxSize = 5 * 1024 * 1024) {
        const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
        return allowedTypes.includes(file.type) && file.size <= maxSize;
      }
      
      // Initialize when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('onboardingForm');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const submitButton = document.getElementById('submitButton');
        
        // File upload handlers
        function setupFileUpload(inputId, infoId) {
          const fileInput = document.getElementById(inputId);
          const fileInfo = document.getElementById(infoId);
          
          if (!fileInput || !fileInfo) return;
          
          fileInput.addEventListener('change', function() {
            const files = this.files;
            if (files.length > 0) {
              let validFiles = [];
              for (let file of files) {
                if (validateFileUpload(file)) {
                  validFiles.push(file.name);
                }
              }
              
              if (validFiles.length > 0) {
                fileInfo.textContent = `Selected: ${validFiles.join(', ')}`;
                fileInfo.className = 'file-upload-info success';
              } else {
                fileInfo.textContent = 'Invalid file type or size. Please select PDF, JPG, or PNG files under 5MB.';
                fileInfo.className = 'file-upload-info error';
                this.value = '';
              }
            } else {
              fileInfo.textContent = 'No file selected';
              fileInfo.className = 'file-upload-info';
            }
          });
        }
        
        // Setup file uploads
        setupFileUpload('menu_upload', 'menuFileInfo');
        setupFileUpload('additional_docs', 'additionalDocsInfo');
        setupFileUpload('faq_upload', 'faqFileInfo');
        
        // Conditional field display logic
        function updateDeliveryPickupFields() {
          const selectedValue = document.querySelector('input[name="delivery_pickup"]:checked')?.value;
          const deliveryServices = document.getElementById('deliveryServices');
          const pickupOptions = document.getElementById('pickupOptions');
          
          deliveryServices.classList.remove('show');
          pickupOptions.classList.remove('show');
          
          if (selectedValue === 'Delivery' || selectedValue === 'Both') {
            deliveryServices.classList.add('show');
          }
          if (selectedValue === 'Pickup' || selectedValue === 'Both') {
            pickupOptions.classList.add('show');
          }
        }
        
        function updateLoginFields() {
          const selectedPlan = document.querySelector('input[name="plan"]:checked')?.value;
          const selectedMethod = document.querySelector('input[name="submission_method"]:checked')?.value;
          const loginSection = document.getElementById('loginSection');
          const proLoginSection = document.getElementById('proLoginSection');
          const sendSecurelyMessage = document.getElementById('sendSecurelyMessage');
          
          loginSection.classList.remove('show');
          proLoginSection.classList.remove('show');
          sendSecurelyMessage.classList.remove('show');
          
          if (selectedMethod === 'Submit through this page') {
            loginSection.classList.add('show');
            if (selectedPlan === 'Pro') {
              proLoginSection.classList.add('show');
            }
          } else if (selectedMethod === 'Use SendSecure.ly') {
            sendSecurelyMessage.classList.add('show');
          }
        }
        
        function updateFaqSection() {
          const hasFaqs = document.querySelector('input[name="has_faqs"]:checked')?.value;
          const faqUploadSection = document.getElementById('faqUploadSection');
          
          if (hasFaqs === 'true') {
            faqUploadSection.classList.add('show');
          } else {
            faqUploadSection.classList.remove('show');
          }
        }
        
        function updateBusinessTypeSection() {
          const businessType = document.getElementById('business_type').value;
          const otherBusinessTypeSection = document.getElementById('otherBusinessTypeSection');
          const otherBusinessTypeInput = document.getElementById('other_business_type');
          
          if (businessType === 'Other') {
            otherBusinessTypeSection.style.display = 'block';
            otherBusinessTypeInput.required = true;
          } else {
            otherBusinessTypeSection.style.display = 'none';
            otherBusinessTypeInput.required = false;
            otherBusinessTypeInput.value = '';
            // Clear any error state
            otherBusinessTypeInput.classList.remove('error');
            document.getElementById('other_business_type_error').style.display = 'none';
          }
        }
        
        // Event listeners
        document.querySelectorAll('input[name="delivery_pickup"]').forEach(radio => {
          radio.addEventListener('change', updateDeliveryPickupFields);
        });
        
        document.querySelectorAll('input[name="plan"]').forEach(radio => {
          radio.addEventListener('change', updateLoginFields);
        });
        
        document.querySelectorAll('input[name="submission_method"]').forEach(radio => {
          radio.addEventListener('change', updateLoginFields);
        });
        
        document.querySelectorAll('input[name="has_faqs"]').forEach(radio => {
          radio.addEventListener('change', updateFaqSection);
        });
        
        document.getElementById('business_type').addEventListener('change', updateBusinessTypeSection);
        
        // Form submission
        // Form validation functions
        function validateForm() {
          let isValid = true;
          let errors = [];
          
          // Clear all previous errors
          document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
          document.querySelectorAll('.form-error').forEach(el => {
            el.style.display = 'none';
            el.textContent = '';
          });
          document.getElementById('generalError').style.display = 'none';
          
          // Required text fields
          const requiredFields = [
            { id: 'business_name', label: 'Business Name' },
            { id: 'instagram_handle', label: 'Instagram Handle' },
            { id: 'business_type', label: 'Business Type' },
            { id: 'product_service_description', label: 'Product/Service Description' },
            { id: 'common_customer_question', label: 'Common Customer Questions' },
            { id: 'contact_email', label: 'Contact Email' }
          ];
          
          requiredFields.forEach(field => {
            const value = document.getElementById(field.id).value;
            if (!validateRequired(value)) {
              showError(field.id, `${field.label} is required`);
              errors.push(`${field.label} is required`);
              isValid = false;
            }
          });
          
          // Email validation
          const emailValue = document.getElementById('contact_email').value;
          if (validateRequired(emailValue) && !validateEmail(emailValue)) {
            showError('contact_email', 'Please enter a valid email address');
            errors.push('Please enter a valid email address');
            isValid = false;
          }
          
          // Conditional validation for "Other" business type
          const businessType = document.getElementById('business_type').value;
          if (businessType === 'Other') {
            const otherBusinessType = document.getElementById('other_business_type').value;
            if (!validateRequired(otherBusinessType)) {
              showError('other_business_type', 'Please specify your business type');
              errors.push('Business type specification is required');
              isValid = false;
            }
          }
          
          // Required radio buttons
          const requiredRadios = [
            { name: 'delivery_pickup', label: 'Delivery/Pickup option' },
            { name: 'plan', label: 'Plan selection' },
            { name: 'submission_method', label: 'Credential submission method' }
          ];
          
          requiredRadios.forEach(radio => {
            const selected = document.querySelector(`input[name=\"${radio.name}\"]:checked`);
            if (!selected) {
              showRadioError(radio.name, `${radio.label} is required`);
              errors.push(`${radio.label} is required`);
              isValid = false;
            }
          });
          
          // Conditional validation for Instagram credentials
          const submissionMethod = document.querySelector('input[name=\"submission_method\"]:checked')?.value;
          if (submissionMethod === 'Submit through this page') {
            const instagramUsername = document.getElementById('instagram_email').value;
            const instagramPassword = document.getElementById('instagram_password').value;
            
            if (!validateRequired(instagramUsername)) {
              showError('instagram_email', 'Instagram Username is required when submitting credentials directly');
              errors.push('Instagram Username is required');
              isValid = false;
            }
            
            if (!validateRequired(instagramPassword)) {
              showError('instagram_password', 'Instagram Password is required when submitting credentials directly');
              errors.push('Instagram Password is required');
              isValid = false;
            }
            
            // For Pro plan, validate Facebook credentials if provided
            const selectedPlan = document.querySelector('input[name=\"plan\"]:checked')?.value;
            if (selectedPlan === 'Pro') {
              const facebookUsername = document.getElementById('facebook_email').value;
              const facebookPassword = document.getElementById('facebook_password').value;
              
              // If one is provided, both must be provided
              if (validateRequired(facebookUsername) && !validateRequired(facebookPassword)) {
                showError('facebook_password', 'Facebook Password is required when Username is provided');
                errors.push('Facebook Password is required when Username is provided');
                isValid = false;
              }
              
              if (validateRequired(facebookPassword) && !validateRequired(facebookUsername)) {
                showError('facebook_email', 'Facebook Username is required when Password is provided');
                errors.push('Facebook Username is required when Password is provided');
                isValid = false;
              }
            }
          }
          
          // Required checkboxes
          const requiredCheckboxes = [
            { id: 'confirm_accurate', label: 'Confirm information is accurate' },
            { id: 'consent_automation', label: 'Consent to automation setup' },
            { id: 'consent_to_share', label: 'Agree to Privacy Policy and Terms' }
          ];
          
          let checkboxValid = true;
          requiredCheckboxes.forEach(checkbox => {
            const checked = document.getElementById(checkbox.id).checked;
            if (!checked) {
              checkboxValid = false;
              errors.push(`${checkbox.label} is required`);
            }
          });
          
          if (!checkboxValid) {
            showCheckboxError('All consent checkboxes are required');
            isValid = false;
          }
          
          // Show general error message if validation fails
          if (!isValid) {
            const generalError = document.getElementById('generalError');
            generalError.textContent = `Please fix the following errors: ${errors.join(', ')}`;
            generalError.style.display = 'block';
            scrollToFirstError();
          }
          
          return isValid;
        }
        
        function showError(fieldId, message) {
          const field = document.getElementById(fieldId);
          const errorElement = document.getElementById(fieldId + '_error');
          
          if (field) {
            field.classList.add('error');
          }
          
          if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.display = 'block';
          }
        }
        
        function clearError(fieldId) {
          const field = document.getElementById(fieldId);
          const errorElement = document.getElementById(fieldId + '_error');
          
          if (field) {
            field.classList.remove('error');
          }
          
          if (errorElement) {
            errorElement.style.display = 'none';
            errorElement.textContent = '';
          }
        }
        
        function showRadioError(name, message) {
          const errorElement = document.getElementById(name + '_error');
          const radioButtons = document.querySelectorAll(`input[name=\"${name}\"]`);
          
          radioButtons.forEach(radio => {
            radio.closest('label').classList.add('error');
          });
          
          if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.display = 'block';
          }
        }
        
        function clearRadioError(name) {
          const errorElement = document.getElementById(name + '_error');
          const radioButtons = document.querySelectorAll(`input[name=\"${name}\"]`);
          
          radioButtons.forEach(radio => {
            radio.closest('label').classList.remove('error');
          });
          
          if (errorElement) {
            errorElement.style.display = 'none';
            errorElement.textContent = '';
          }
        }
        
        function showCheckboxError(message) {
          const errorElement = document.getElementById('consent_checkboxes_error');
          const checkboxes = document.querySelectorAll('#confirm_accurate, #consent_automation, #consent_to_share');
          
          checkboxes.forEach(checkbox => {
            checkbox.closest('label').classList.add('error');
          });
          
          if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.display = 'block';
          }
        }
        
        function clearCheckboxError() {
          const errorElement = document.getElementById('consent_checkboxes_error');
          const checkboxes = document.querySelectorAll('#confirm_accurate, #consent_automation, #consent_to_share');
          
          checkboxes.forEach(checkbox => {
            checkbox.closest('label').classList.remove('error');
          });
          
          if (errorElement) {
            errorElement.style.display = 'none';
            errorElement.textContent = '';
          }
        }
        
        function scrollToFirstError() {
          const firstError = document.querySelector('.error, .form-error[style*=\"block\"]');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
        
        // Add real-time validation listeners
        function addValidationListeners() {
          const textInputs = document.querySelectorAll('input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], textarea, select');
          textInputs.forEach(input => {
            input.addEventListener('input', function() {
              clearError(this.id);
            });
          });
          
          const radioInputs = document.querySelectorAll('input[type=\"radio\"]');
          radioInputs.forEach(radio => {
            radio.addEventListener('change', function() {
              clearRadioError(this.name);
            });
          });
          
          const checkboxInputs = document.querySelectorAll('#confirm_accurate, #consent_automation, #consent_to_share');
          checkboxInputs.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
              clearCheckboxError();
            });
          });
        }
        
        // Initialize validation listeners
        addValidationListeners();
        
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          if (submitButton.disabled) return;
          
          // Validate form first
          if (!validateForm()) {
            return;
          }
          
          // Show loading state
          loadingSpinner.style.display = 'block';
          errorMessage.style.display = 'none';
          successMessage.style.display = 'none';
          document.getElementById('generalError').style.display = 'none';
          submitButton.disabled = true;
          submitButton.textContent = 'Processing...';
          
          // Collect form data
          const formData = new FormData(form);
          const data = {};
          
          // Convert FormData to object
          for (let [key, value] of formData.entries()) {
            if (key === 'delivery_services') {
              if (!data.delivery_services) data.delivery_services = [];
              data.delivery_services.push(sanitizeInput(value));
            } else if (key.startsWith('checklist_')) {
              // Handle checklist items
              if (!data.checklist_items) data.checklist_items = [];
              if (value) data.checklist_items.push(key.replace('checklist_', ''));
            } else {
              data[key] = sanitizeInput(value);
            }
          }
          
          // Handle arrays
          if (data.delivery_services) {
            data.delivery_services = data.delivery_services.join(', ');
          }
          
          // Add boolean fields
          data.confirm_accurate = document.getElementById('confirm_accurate')?.checked || false;
          data.consent_automation = document.getElementById('consent_automation')?.checked || false;
          data.consent_to_share = document.getElementById('consent_to_share')?.checked || false;
          data.has_faqs = document.querySelector('input[name="has_faqs"]:checked')?.value === 'true';
                    
                    // Handle conditional field requirements to prevent 422 errors
                    if (!data.menu_upload && !data.menu_text) {
                      data.menu_text = ''; // Backend expects either menu_upload or menu_text
                    }
                    
                    if ((data.delivery_pickup === 'Delivery' || data.delivery_pickup === 'Both') && !data.delivery_services && !data.delivery_other) {
                      data.delivery_services = ''; // Provide empty string if no services selected
                    }
                    
                    if ((data.delivery_pickup === 'Pickup' || data.delivery_pickup === 'Both') && !data.pickup_method) {
                      data.pickup_method = ''; // Provide empty string if no method selected
                    }
                    
                    // Add timestamp
                    data.submission_timestamp = new Date().toISOString();
          
          // Submit form
                    console.log('Submitting form data:', data);
          fetch('/api/submit-onboarding', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          })
          .then(response => {
                      console.log('Response status:', response.status);
                      if (!response.ok) {
                        return response.text().then(text => {
                          console.error('Server response:', text);
                          throw new Error(`Server error (${response.status}): ${text}`);
                        });
                      }
                      return response.json();
                    })
          .then(data => {
            if (data.success && data.stripe_url) {
              successMessage.style.display = 'block';
              successMessage.textContent = data.message || 'Form submitted successfully!';
              setTimeout(() => {
                window.location.href = data.stripe_url;
              }, 1500);
            } else {
              throw new Error(data.message || 'Submission failed');
            }
          })
          .catch(error => {
            errorMessage.style.display = 'block';
            errorMessage.textContent = error.message || 'Network error. Please try again.';
            resetForm();
          });
        });
        
        function resetForm() {
          loadingSpinner.style.display = 'none';
          submitButton.disabled = false;
          submitButton.textContent = 'üéâ Start My Setup';
        }
        
        // Real-time validation for "Other" business type field
        document.getElementById('other_business_type').addEventListener('input', function() {
          if (this.value.trim() !== '') {
            this.classList.remove('error');
            document.getElementById('other_business_type_error').style.display = 'none';
          }
        });
        
        // Initialize conditional fields
        updateDeliveryPickupFields();
        updateLoginFields();
        updateFaqSection();
        updateBusinessTypeSection();
      });
    })();
  </script>
</body>
</html>